<% extend("../app.ejs") %>
<section class="mt-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-2">
                <div class="homepage-logo mt-2">
                    <img class="menu-nav" src="../images/background/menu-nav.png" alt="img logo">
                    <span>Strongbody</span>
                </div>
                <div class="home-nav">
                    <div class="nav-item">
                        <% if(user){%>
                            <a href="/users" target="_blank">Dashboard</a>

                            <%} else {%>
                                <a href="/login">Log in</a>
                            <% }%>
                    </div>
                </div>
            </div>
            <div class="col-8 d-none d-md-block d-md-flex justify-content-between ">
                <div class="d-flex flex-column">
                    <span>Specialist</span>
                    <span>Search by specialist doctor</span>
                </div>
                <div class="d-flex flex-column">
                    <span>Health facilities</span>
                    <span>Choose hospitals, clinics</span>
                </div>
                <div class="d-flex flex-column">
                    <span>Doctors</span>
                    <span>Choose good doctors</span>
                </div>
                <div class="d-flex flex-column">
                    <span>Examination package</span>
                    <span>General health check</span>
                </div>
            </div>
            <div class="col-2 d-flex justify-content-center align-items-center">
                <span title="Have questions?"><a href="https://www.youtube.com/embed/NDcQeKD2TO8?si=c7eoeypzdUuMMAjI" target="_blank" class="text-decoration-none">Do you need support?</a></span>
            </div>
        </div>
    </div>
</section>
<section class="sec-header d-flex flex-column">
    <div class="img-header d-flex flex-column mt-3 ">
        <div class="text-center mt-5"><span style="font-size: 25px">SPECIALIZED EXPLORE BOOKING PLATFORM</span></div>
        <div class="header-search align-self-center justify-content-center mt-5">
            <i class="fa fa-search"></i>
            <label for="input-search"></label>
            <input id="input-search" placeholder="Looking for information...">
            <div id="show-info-search" class="show-info-search">

            </div>
        </div>
    </div>
    <div class="content-header d-flex  justify-content-between title-and-icon align-items-center">
        <div class="d-flex flex-column ml-5 pl-5 align-items-center">
            <i class="fa fa-check"></i>
            <span>Prestigious hospitals</span>
        </div>
        <div class="d-flex flex-column align-items-center">
            <i class="fa fa-thumbs-up"></i>
            <span>Good clinics</span>
        </div>
        <div class="d-flex flex-column align-items-center">
            <i class="fa fa-user-md"></i>
            <span>Out standing doctors</span>
        </div>
        <div class="d-flex flex-column mr-5 pr-5 align-items-center">
            <i class="fa fa-clock-o"></i>
            <span>Priority examination</span>
        </div>
    </div>
</section>
<section class="sec-fields-hospital d-flex flex-column">
    <div class="sec-fields-title mx-auto d-flex my-3">
        <h2 class="">Popular specialties</h2>
        <a class="flex-grow-1 my-auto"><span class="d-block show-all-specializations">All specialties</span></a>
    </div>
    <div class="section-slide">
        <div class="slider slider-nav text-decoration-none">
            <% specializations.forEach(function(x) { %>
                <a href="/detail/specialization/<%= x.id %>" class="a-specialization text-decoration-none"
                   style="outline: none">
                    <div class="d-flex flex-column slide-fields specialization" data-specialization="<%= x.id %>">
                        <img src="/images/specializations/<%= x.image %>" alt="image bla bla">
                        <h3 class="text-decoration-none"><%= x.name %></h3>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>
</section>
<section class="sec-hospitals">
    <div class="sec-fields-title mx-auto d-flex my-3">
        <h2 class="">Top clinics</h2>
        <a class="flex-grow-1 my-auto"><span class="d-block show-all-clinics">All clinics</span></a>
    </div>
    <div class="section-slide">
        <div class="slider slider-nav text-decoration-none">
            <% clinics.forEach(function(clinic) { %>
                <a href="/detail/clinic/<%= clinic.id %>" class="text-decoration-none" style="outline: none">
                    <div class="d-flex flex-column slide-fields clinics" data-clinic="<%= clinic.id %>">
                        <img src="/images/clinics/<%= clinic.image %>"
                             alt="image bla bla">
                        <h3><%= clinic.name %></h3>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>
</section>
<section class="sec-doctors">
    <div class="sec-fields-title mx-auto d-flex my-3">
        <h2 class="">Out standing doctors</h2>
        <a class="flex-grow-1 my-auto"><span class="d-block show-all-doctors">All doctors</span></a>
    </div>
    <div class="section-slide">
        <div class="slider slider-nav text-decoration-none">
            <% doctors.forEach(function(doctor) { %>
                <a href="/detail/doctor/<%= doctor.id %>" class="text-decoration-none" style="outline: none">
                    <div class="slide-doctors text-decoration-none">
                        <div class="doctor-avatar">
                            <img src="/images/users/<%= doctor.avatar %>"
                                 alt="image bla bla">
                            <h3 style="color: black"><%= doctor.name %></h3>
                            <h4 style="color: black"><%= doctor.getDataValue('specializationName') %></h4>
                            <span title="Counting the number of patients have been booked" style="color: #0056b3"> <%= doctor.getDataValue('countBooking') %> patients (booked)</span>
                        </div>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>
</section>
<section class="sec-posts">
    <div class="sec-fields-title mx-auto d-flex my-3">
        <h2 class="">Handbooks</h2>
        <a class="flex-grow-1 my-auto text-decoration-none" href="/all-posts"><span class="d-block text-decoration-none">All posts</span></a>
    </div>
    <div class="section-slide">
        <div class="slider slider-nav-posts">
            <% posts.forEach(function(post) { %>
                <a href="/detail/post/<%= post.id %>" class="text-decoration-none" style="outline: none">
                    <div class="d-flex flex-row slide-post">
                        <div class="img-post">
                            <img src="https://cdn.bookingcare.vn/fr/w500/2018/06/18/113541benh-vien-bao-son.jpg"
                                 alt="image bla bla">
                        </div>
                        <div class="content-post">
                            <h3>
                                <%= post.title %>
                            </h3>
                            <p>
                                <%= post.getDataValue('content') %>
                            </p>
                        </div>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>
</section>
<section class="sec-for-doctors">

<div class="d-flex flex-row mx-auto main-for-doctors">
    <div class="d-flex flex-column col-5">
        <h1 class="mt-4">For doctors</h1>
        <!-- <span class="mt-3 mb-1">Build credibility and brand online</span> -->
        <!-- <span>Increase the number of patients and manage effectively</span> -->
        <a href="/contact" class="mt-5 pd-3 contact-admin text-decoration-none">CONTACT COOPERATION</a>
    </div>
    <div class="col-7 d-flex justify-content-end" style="padding-top: 5px">
        <iframe width="500" height="290" src="https://www.youtube.com/embed/NDcQeKD2TO8?si=vMZPo4jqpqHnAzbt" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
</div>

</section>

<!-- FAQ Chatbox -->
<div id="faq-chatbox" class="faq-chatbox">
    <div class="chatbox-header" onclick="toggleChatbox()">
        <i class="fa fa-comments"></i>
        <span>FAQ</span>
        <i class="fa fa-chevron-up" id="chatbox-toggle-icon"></i>
    </div>
    <div class="chatbox-body" id="chatbox-body">
        <div class="faq-welcome">
            <p><strong>Xin chào! Tôi có thể giúp gì cho bạn?</strong></p>
            <p>Chọn một câu hỏi bên dưới:</p>
        </div>
        <div class="faq-questions">
            <div class="faq-question" onclick="showAnswer(1)">
                <i class="fa fa-question-circle"></i>
                Làm thế nào để đặt lịch khám?
            </div>
            <div class="faq-question" onclick="showAnswer(2)">
                <i class="fa fa-question-circle"></i>
                Có thể hủy lịch hẹn không?
            </div>
            <div class="faq-question" onclick="showAnswer(3)">
                <i class="fa fa-question-circle"></i>
                Phí khám bệnh như thế nào?
            </div>
            <div class="faq-question" onclick="showAnswer(4)">
                <i class="fa fa-question-circle"></i>
                Làm sao liên hệ với bác sĩ?
            </div>
            <div class="faq-question" onclick="showAnswer(5)">
                <i class="fa fa-question-circle"></i>
                Có hỗ trợ bảo hiểm y tế không?
            </div>
            <div class="ask-ai-section">
                <div class="separator">
                    <span>Hoặc hỏi AI Assistant</span>
                </div>
                <div class="ai-input-container">
                    <input type="text" id="ai-question-input" placeholder="Nhập câu hỏi của bạn..." maxlength="500">
                    <button onclick="askAI()" id="ask-ai-btn" disabled>
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="faq-answers" id="faq-answers" style="display: none;">
            <div class="answer-header">
                <button onclick="backToQuestions()" class="back-btn">
                    <i class="fa fa-arrow-left"></i> Quay lại
                </button>
            </div>
            <div id="answer-content"></div>
        </div>
        <div class="ai-chat" id="ai-chat" style="display: none;">
            <div class="answer-header">
                <button onclick="backToQuestions()" class="back-btn">
                    <i class="fa fa-arrow-left"></i> Quay lại
                </button>
            </div>
            <div class="ai-messages" id="ai-messages">
                <div class="user-message" id="user-question"></div>
                <div class="ai-response" id="ai-response">
                    <div class="loading-indicator" id="loading-indicator">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span>AI đang suy nghĩ...</span>
                    </div>
                    <div class="ai-answer" id="ai-answer" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal show all specializations-->
<div class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"
     id="modalAllSpecializations">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">All specialties</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row all-specializations-body px-2">
                    <% specializations.forEach(function(x) { %>
                        <div class="col-12 col-spe pl-3"><a href="/detail/specialization/<%= x.id %>" class="text-decoration-none"><%= x.name %> </a></div>
                        <% }) %>
                        <div class="col-12 col-spe pl-3"><a href="/all-specializations" class="text-decoration-none">View all</a></div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btn-confirm-booking-spe"  data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal show all clinics-->
<div class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"
     id="modalAllClinics">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">All clinics</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row all-specializations-body px-2">
                    <% clinics.forEach(function(x) { %>
                        <div class="col-12 col-spe pl-3"><a href="/detail/clinic/<%= x.id %>" class="text-decoration-none"><%= x.name %> </a></div>
                    <% }) %>
                        <div class="col-12 col-spe pl-3"><a href="/all-clinics" class="text-decoration-none">View all</a></div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btn-confirm-booking-spe"  data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal show all doctors-->
<div class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"
     id="modalAllDoctors">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">All doctors</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row all-doctors-body px-2">
                    <% doctors.forEach(function(x) { %>
                        <div class="col-12 col-spe pl-3"><a href="/detail/doctor/<%= x.id %>" class="text-decoration-none"><%= x.name %> </a></div>
                    <% }) %>
                </div>
                <div class="row all-doctors-body px-2">
                        <div class="col-12 col-spe pl-3"><a href="/all-doctors %>" class="text-decoration-none">View all</a></div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btn-confirm-booking-spe"  data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<style>
.faq-chatbox {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 350px;
    max-height: 500px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    overflow: hidden;
    transition: all 0.3s ease;
}

.chatbox-header {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    padding: 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: bold;
}

.chatbox-header:hover {
    background: linear-gradient(135deg, #0056b3, #004085);
}

.chatbox-body {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
    transition: all 0.3s ease;
}

.chatbox-body.collapsed {
    max-height: 0;
    padding: 0 20px;
    overflow: hidden;
}

.faq-welcome {
    margin-bottom: 15px;
    text-align: center;
}

.faq-welcome p {
    margin: 5px 0;
    color: #333;
}

.faq-questions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.faq-question {
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    border-left: 3px solid #007bff;
}

.faq-question:hover {
    background: #e3f2fd;
    transform: translateX(5px);
}

.faq-question i {
    color: #007bff;
}

.faq-answers {
    animation: slideIn 0.3s ease;
}

.answer-header {
    margin-bottom: 15px;
}

.back-btn {
    background: #6c757d;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background 0.3s ease;
}

.back-btn:hover {
    background: #5a6268;
}

#answer-content {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
    line-height: 1.6;
}

.ask-ai-section {
    margin-top: 20px;
    padding-top: 15px;
}

.separator {
    text-align: center;
    position: relative;
    margin-bottom: 15px;
}

.separator::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #e0e0e0;
}

.separator span {
    background: white;
    padding: 0 15px;
    color: #666;
    font-size: 12px;
    position: relative;
}

.ai-input-container {
    display: flex;
    gap: 8px;
    align-items: center;
}

#ai-question-input {
    flex: 1;
    padding: 10px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 20px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

#ai-question-input:focus {
    border-color: #007bff;
}

#ask-ai-btn {
    background: #007bff;
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

#ask-ai-btn:hover:not(:disabled) {
    background: #0056b3;
    transform: scale(1.1);
}

#ask-ai-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

.ai-chat {
    animation: slideIn 0.3s ease;
}

.ai-messages {
    max-height: 300px;
    overflow-y: auto;
}

.user-message {
    background: #007bff;
    color: white;
    padding: 10px 15px;
    border-radius: 15px 15px 5px 15px;
    margin-bottom: 10px;
    max-width: 80%;
    margin-left: auto;
    word-wrap: break-word;
}

.ai-response {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 15px 15px 15px 5px;
    border-left: 4px solid #28a745;
    margin-bottom: 10px;
}

.loading-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #666;
}

.typing-dots {
    display: flex;
    gap: 3px;
}

.typing-dots span {
    width: 6px;
    height: 6px;
    background: #007bff;
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}

.ai-answer {
    line-height: 1.6;
    color: #333;
}

.ai-answer h5 {
    color: #007bff;
    margin-bottom: 10px;
}

.ai-answer ul {
    padding-left: 20px;
}

.ai-answer em {
    color: #666;
    font-style: italic;
}

#chatbox-toggle-icon {
    margin-left: auto;
    transition: transform 0.3s ease;
}

.collapsed-icon {
    transform: rotate(180deg);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@media (max-width: 768px) {
    .faq-chatbox {
        width: 300px;
        right: 10px;
        bottom: 10px;
    }
}
</style>

<script>
let chatboxCollapsed = false;
const GEMINI_API_KEY = 'AIzaSyDZ_eeLkzyXaHX3kQcTxXFfz-_QZHKYUs8';
const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`;

// Enable/disable AI button based on input
document.addEventListener('DOMContentLoaded', function() {
    const aiInput = document.getElementById('ai-question-input');
    const aiBtn = document.getElementById('ask-ai-btn');
    
    if (aiInput && aiBtn) {
        aiInput.addEventListener('input', function() {
            aiBtn.disabled = this.value.trim().length === 0;
        });
        
        aiInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !aiBtn.disabled) {
                askAI();
            }
        });
    }
});

function toggleChatbox() {
    const chatboxBody = document.getElementById('chatbox-body');
    const toggleIcon = document.getElementById('chatbox-toggle-icon');
    
    chatboxCollapsed = !chatboxCollapsed;
    
    if (chatboxCollapsed) {
        chatboxBody.classList.add('collapsed');
        toggleIcon.classList.add('collapsed-icon');
    } else {
        chatboxBody.classList.remove('collapsed');
        toggleIcon.classList.remove('collapsed-icon');
    }
}

function showAnswer(questionId) {
    const questionsDiv = document.querySelector('.faq-questions');
    const answersDiv = document.getElementById('faq-answers');
    const answerContent = document.getElementById('answer-content');
    
    const answers = {
        1: `
            <h5><i class="fa fa-calendar"></i> Cách đặt lịch khám</h5>
            <p><strong>Bước 1:</strong> Chọn chuyên khoa hoặc bác sĩ mà bạn muốn khám</p>
            <p><strong>Bước 2:</strong> Chọn thời gian phù hợp trong lịch có sẵn</p>
            <p><strong>Bước 3:</strong> Điền thông tin cá nhân và xác nhận đặt lịch</p>
            <p><strong>Bước 4:</strong> Bạn sẽ nhận được xác nhận qua email hoặc SMS</p>
            <p><em>💡 Mẹo: Nên đặt lịch trước ít nhất 1-2 ngày để có nhiều lựa chọn thời gian hơn.</em></p>
        `,
        2: `
            <h5><i class="fa fa-times-circle"></i> Hủy lịch hẹn</h5>
            <p><strong>Có thể hủy:</strong> Bạn có thể hủy lịch hẹn trước 24 giờ mà không mất phí</p>
            <p><strong>Cách hủy:</strong></p>
            <ul>
                <li>Đăng nhập vào tài khoản và vào phần "Lịch hẹn của tôi"</li>
                <li>Gọi điện thoại đến hotline: <strong>1900-xxxx</strong></li>
                <li>Gửi email đến: support@strongbody.com</li>
            </ul>
            <p><em>⚠️ Lưu ý: Hủy muộn hơn 24 giờ có thể phát sinh phí hủy lịch.</em></p>
        `,
        3: `
            <h5><i class="fa fa-money"></i> Phí khám bệnh</h5>
            <p><strong>Phí khám:</strong> Từ 200.000đ - 500.000đ tùy vào chuyên khoa</p>
            <p><strong>Thanh toán:</strong></p>
            <ul>
                <li>Tiền mặt tại phòng khám</li>
                <li>Chuyển khoản ngân hàng</li>
                <li>Ví điện tử (MoMo, ZaloPay)</li>
                <li>Thẻ tín dụng/ghi nợ</li>
            </ul>
            <p><strong>Ưu đãi:</strong> Giảm 10% cho lần khám đầu tiên</p>
            <p><em>💳 Chấp nhận hầu hết các loại bảo hiểm y tế.</em></p>
        `,
        4: `
            <h5><i class="fa fa-phone"></i> Liên hệ với bác sĩ</h5>
            <p><strong>Trước khám:</strong> Liên hệ qua hotline hoặc nhắn tin trong app</p>
            <p><strong>Sau khám:</strong></p>
            <ul>
                <li>Tư vấn qua điện thoại (miễn phí trong 7 ngày)</li>
                <li>Nhắn tin trực tiếp với bác sĩ qua app</li>
                <li>Email: doctor@strongbody.com</li>
            </ul>
            <p><strong>Khẩn cấp:</strong> Gọi 115 hoặc đến trực tiếp bệnh viện</p>
            <p><em>🕐 Thời gian phản hồi: 2-4 giờ trong giờ hành chính.</em></p>
        `,
        5: `
            <h5><i class="fa fa-shield"></i> Hỗ trợ bảo hiểm y tế</h5>
            <p><strong>Được hỗ trợ:</strong></p>
            <ul>
                <li>BHYT Nhà nước</li>
                <li>Bảo hiểm tư nhân (Prudential, AIA, Bảo Việt...)</li>
                <li>Bảo hiểm công ty</li>
            </ul>
            <p><strong>Quy trình:</strong></p>
            <p>1. Mang theo thẻ BHYT khi đến khám</p>
            <p>2. Khai báo thông tin bảo hiểm khi đăng ký</p>
            <p>3. Phòng khám sẽ hỗ trợ làm thủ tục</p>
            <p><em>📋 Lưu ý: Một số dịch vụ có thể không được bảo hiểm chi trả.</em></p>
        `
    };
    
    answerContent.innerHTML = answers[questionId] || '<p>Câu trả lời không tìm thấy.</p>';
    questionsDiv.style.display = 'none';
    answersDiv.style.display = 'block';
    document.querySelector('.faq-welcome').style.display = 'none';
}

async function askAI() {
    const input = document.getElementById('ai-question-input');
    const question = input.value.trim();
    
    if (!question) return;
    
    // Show AI chat interface
    const questionsDiv = document.querySelector('.faq-questions');
    const aiChatDiv = document.getElementById('ai-chat');
    const userMessageDiv = document.getElementById('user-question');
    const loadingDiv = document.getElementById('loading-indicator');
    const aiAnswerDiv = document.getElementById('ai-answer');
    
    // Hide questions and show AI chat
    questionsDiv.style.display = 'none';
    aiChatDiv.style.display = 'block';
    document.querySelector('.faq-welcome').style.display = 'none';
    
    // Display user question
    userMessageDiv.textContent = question;
    userMessageDiv.style.display = 'block';
    
    // Show loading
    loadingDiv.style.display = 'flex';
    aiAnswerDiv.style.display = 'none';
    
    // Clear input
    input.value = '';
    document.getElementById('ask-ai-btn').disabled = true;
    
    try {
        const response = await fetch(GEMINI_API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{
                        text: `Bạn là một trợ lý AI thông minh của nền tảng y tế Strongbody. Nhiệm vụ của bạn là trả lời các câu hỏi về sức khỏe, y tế, đặt lịch khám bệnh và các dịch vụ của phòng khám một cách chuyên nghiệp, thân thiện và hữu ích.

Ngữ cảnh về Strongbody:
- Là nền tảng đặt lịch khám bệnh trực tuyến
- Có nhiều chuyên khoa, bác sĩ giỏi và phòng khám uy tín
- Hỗ trợ đặt lịch online, thanh toán đa dạng
- Có bảo hiểm y tế và chương trình ưu đãi

Hãy trả lời câu hỏi sau một cách chi tiết, dễ hiểu và có cấu trúc rõ ràng. Sử dụng emoji phù hợp để làm cho câu trả lời sinh động hơn:

Câu hỏi: ${question}`
                    }]
                }]
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
            const aiResponse = data.candidates[0].content.parts[0].text;
            
            // Hide loading and show answer
            loadingDiv.style.display = 'none';
            aiAnswerDiv.innerHTML = formatAIResponse(aiResponse);
            aiAnswerDiv.style.display = 'block';
        } else {
            throw new Error('Không nhận được phản hồi hợp lệ từ AI');
        }
        
    } catch (error) {
        console.error('AI API Error:', error);
        
        // Hide loading and show error
        loadingDiv.style.display = 'none';
        aiAnswerDiv.innerHTML = `
            <div style="color: #dc3545; text-align: center; padding: 20px;">
                <i class="fa fa-exclamation-triangle"></i>
                <p><strong>Xin lỗi!</strong></p>
                <p>Hiện tại AI đang gặp sự cố. Vui lòng:</p>
                <ul style="text-align: left; margin-top: 10px;">
                    <li>Thử lại sau vài phút</li>
                    <li>Liên hệ hotline: <strong>1900-xxxx</strong></li>
                    <li>Email: support@strongbody.com</li>
                </ul>
                <p><em>Cảm ơn bạn đã thông cảm! 🙏</em></p>
            </div>
        `;
        aiAnswerDiv.style.display = 'block';
    }
}

function formatAIResponse(text) {
    // Basic formatting for AI response
    let formatted = text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
    
    return `<p>${formatted}</p>`;
}

function backToQuestions() {
    const questionsDiv = document.querySelector('.faq-questions');
    const answersDiv = document.getElementById('faq-answers');
    const aiChatDiv = document.getElementById('ai-chat');
    
    questionsDiv.style.display = 'flex';
    answersDiv.style.display = 'none';
    aiChatDiv.style.display = 'none';
    document.querySelector('.faq-welcome').style.display = 'block';
}

// Auto-hide chatbox on mobile when scrolling
let lastScrollTop = 0;
window.addEventListener('scroll', function() {
    if (window.innerWidth <= 768) {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const chatbox = document.getElementById('faq-chatbox');
        
        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // Scrolling down
            chatbox.style.transform = 'translateY(100px)';
            chatbox.style.opacity = '0.7';
        } else {
            // Scrolling up
            chatbox.style.transform = 'translateY(0)';
            chatbox.style.opacity = '1';
        }
        lastScrollTop = scrollTop;
    }
});
